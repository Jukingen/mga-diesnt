<!doctype html>
<html>

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Content Manager</title>

  <script src="/.netlify/identity/v1/netlify-identity-widget.js"></script>

  <script>
    if (location.hash.startsWith("#/")) {
      location.replace(location.href.replace("#/", "#"));
      return;
    }

    const hasToken =
      location.hash.includes("recovery_token=") ||
      location.hash.includes("invite_token=");

    if (hasToken && !location.pathname.startsWith("/admin")) {
      location.replace("/admin/" + location.hash);
      return;
    }

    window.addEventListener("load", () => {
      if (!window.netlifyIdentity) return;

      window.netlifyIdentity.init();

      if (location.hash.includes("invite_token=")) window.netlifyIdentity.open();
      if (location.hash.includes("recovery_token=")) window.netlifyIdentity.open("recover");

      window.netlifyIdentity.on("login", () => {
        document.location.href = "/admin/";
      });
    });
  </script>
</head>

<body>
  <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
</body>

</html>