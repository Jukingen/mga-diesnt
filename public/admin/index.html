<!doctype html>
<html>

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Content Manager</title>

  <!-- CORS fix: site origin üzerinden yükle -->
  <script src="/.netlify/identity/v1/netlify-identity-widget.js"></script>

  <script>
    // Eğer invite/recovery token root'a düşerse admin'e taşı
    const hasToken =
      location.hash.includes("recovery_token=") ||
      location.hash.includes("invite_token=");

    if (hasToken && !location.pathname.startsWith("/admin")) {
      location.replace("/admin/" + location.hash);
    }

    window.addEventListener("load", () => {
      if (!window.netlifyIdentity) return;

      // IMPORTANT: init'i zorla
      window.netlifyIdentity.init();

      // Invite token varsa modalı aç (şifre belirleme/hesap oluşturma akışı)
      if (location.hash.includes("invite_token=")) {
        window.netlifyIdentity.open();
      }

      // Recovery token varsa recover akışını aç
      if (location.hash.includes("recovery_token=")) {
        window.netlifyIdentity.open("recover");
      }

      // Login olunca admin'e dön
      window.netlifyIdentity.on("login", () => {
        document.location.href = "/admin/";
      });
    });
  </script>
</head>

<body>
  <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
</body>

</html>