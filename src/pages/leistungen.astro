---
import { getEntry, getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import Button from '../components/Button.astro';

const services = await getCollection('services');
const sortedServices = services.sort((a, b) => (a.data.order || 99) - (b.data.order || 99));

const entry = await getEntry('pages', 'home'); // Reusing home page hero settings or could create a specific services page
if (!entry) throw new Error('Home entry not found');
// Or if you want a dedicated services content entry, you should create one.
const { title: homeTitle, headerBanner } = entry.data as any; // Extract headerBanner from home or use global
// Let's assume we use fixed header for now as there is no specific 'services' page content yet in CMS config for "pages" collection except generic ones.
// Based on config.yml, there is NO 'services' page in 'pages' collection. I will check.
// There is no specific page entry for 'leistungen'. I will use default or empty headerBanner unless I add it.
// Wait, I can pass undefined headerBanner and it will use global.

---

<BaseLayout 
  title="Unsere Leistungen - MIGA Dienstleistungen GmbH"
  description="Professionelle Dienstleistungen: Reinigung, Grünflächenpflege, Winterdienst, Transport, Tischler-, Montage-, Bauarbeiten, Sanitär und KFZ-Service in Graz."
  headerBanner={headerBanner}
>
  <!-- Header -->
  <section class="bg-gradient-to-r from-primary-600 to-primary-700 text-white py-16">
    <div class="container-custom">
      <h1 class="heading-1 text-white mb-4">Unsere Leistungen</h1>
      <p class="text-xl text-primary-50">Professionelle Dienstleistungen für jeden Bedarf</p>
    </div>
  </section>

  <!-- Services -->
  <section class="section bg-white">
    <div class="container-custom">
      {sortedServices.map((service, index) => (
        <div id={service.slug} class="mb-16 scroll-mt-20">
          <div class="card overflow-hidden">
            <div class="flex flex-col md:flex-row">
              {(service.data as any).image && (
                <div class="md:w-1/3 h-64 md:h-auto relative">
                   <img 
                    src={(service.data as any).image} 
                    alt={service.data.title} 
                    class="absolute inset-0 w-full h-full object-cover"
                    loading="lazy"
                  />
                </div>
              )}
              <div class={`p-6 md:p-8 ${(service.data as any).image ? 'md:w-2/3' : 'w-full'}`}>
                <h2 class="heading-3 mb-6 text-primary-600">{index + 1}. {service.data.title}</h2>
                <p class="mb-6 text-dark-600">{service.data.description}</p>
                <ul class="grid grid-cols-1 sm:grid-cols-2 gap-3 text-dark-700">
                  {service.data.items.map(item => (
                     <li class="flex items-start"><span class="text-primary-600 mr-2">•</span> {item}</li>
                  ))}
                </ul>
              </div>
            </div>
          </div>
        </div>
      ))}
    </div>
  </section>

  <!-- CTA -->
  <section class="section bg-gradient-to-r from-primary-600 to-primary-700 text-white">
    <div class="container-custom text-center">
      <h2 class="heading-2 text-white mb-6">Interesse an unseren Leistungen?</h2>
      <p class="text-xl text-primary-50 mb-8">Kontaktieren Sie uns für ein unverbindliches Angebot</p>
      <Button href="/kontakt" variant="primary" size="lg" class="shadow-xl">Jetzt Kontakt aufnehmen</Button>
    </div>
  </section>
</BaseLayout>
