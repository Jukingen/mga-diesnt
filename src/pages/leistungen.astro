---
import { getEntry, getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import Button from '../components/Button.astro';

const services = await getCollection('services');
const sortedServices = services.sort((a, b) => (a.data.order || 99) - (b.data.order || 99));

const entry = await getEntry('pages', 'home'); // Reusing home page hero settings or could create a specific services page
if (!entry) throw new Error('Home entry not found');
// Or if you want a dedicated services content entry, you should create one.
const { title: homeTitle, headerBanner } = entry.data as any; // Extract headerBanner from home or use global
// Let's assume we use fixed header for now as there is no specific 'services' page content yet in CMS config for "pages" collection except generic ones.
// Based on config.yml, there is NO 'services' page in 'pages' collection. I will check.
// There is no specific page entry for 'leistungen'. I will use default or empty headerBanner unless I add it.
// Wait, I can pass undefined headerBanner and it will use global.

---

<BaseLayout 
  title="Unsere Leistungen - MIGA Dienstleistungen GmbH"
  description="Professionelle Dienstleistungen: Reinigung, Grünflächenpflege, Winterdienst, Transport, Tischler-, Montage-, Bauarbeiten, Sanitär und KFZ-Service in Graz."
  headerBanner={headerBanner}
>
  <!-- Header -->
  <section class="bg-gradient-to-r from-primary-600 to-primary-700 text-white py-16">
    <div class="container-custom">
      <h1 class="heading-1 text-white mb-4">Unsere Leistungen</h1>
      <p class="text-xl text-primary-50">Professionelle Dienstleistungen für jeden Bedarf</p>
    </div>
  </section>

  <!-- Services -->
  <section class="section bg-white">
    <div class="container-custom">
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
      {sortedServices.map((service, index) => (
        <a href={`/leistungen/${service.slug}`} class="group block h-full">
          <div class="card overflow-hidden h-full flex flex-col hover:shadow-lg transition-all duration-300 border border-gray-100 group-hover:border-primary-200">
              {(service.data as any).image && (
                <div class="h-48 relative overflow-hidden">
                   <img 
                    src={(service.data as any).image} 
                    alt={service.data.title} 
                    class="absolute inset-0 w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"
                    loading="lazy"
                  />
                </div>
              )}
              <div class="p-6 flex-grow flex flex-col">
                <h2 class="heading-4 mb-3 text-primary-600 group-hover:text-primary-700 transition-colors flex items-center">
                    <span class="mr-2 text-primary-400 font-light text-2xl">0{index + 1}</span>
                    {service.data.title}
                </h2>
                <p class="mb-4 text-dark-600 line-clamp-3">{service.data.description}</p>
                <div class="mt-auto">
                    <span class="text-sm font-semibold text-primary-600 flex items-center">
                        Mehr erfahren
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1 transform transition-transform group-hover:translate-x-1" viewBox="0 0 20 20" fill="currentColor">
                             <path fill-rule="evenodd" d="M12.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd" />
                        </svg>
                    </span>
                </div>
              </div>
          </div>
        </a>
      ))}
      </div>
    </div>
  </section>

  <!-- CTA -->
  <section class="section bg-gradient-to-r from-primary-600 to-primary-700 text-white">
    <div class="container-custom text-center">
      <h2 class="heading-2 text-white mb-6">Interesse an unseren Leistungen?</h2>
      <p class="text-xl text-primary-50 mb-8">Kontaktieren Sie uns für ein unverbindliches Angebot</p>
      <Button href="/kontakt" variant="primary" size="lg" class="shadow-xl">Jetzt Kontakt aufnehmen</Button>
    </div>
  </section>
</BaseLayout>
